<div class="container-fluid">
<div class="row" style="padding-bottom: 25px">
    <div class="col-md-6">
      <div leaflet class="map pull-left"
        [leafletOptions]="options"
        (leafletMapMoveEnd)="onMove($event)"
        (leafletMapReady)="onMapReady($event)" >
      </div>
    </div>

    <div *ngIf="isSiteDateGeoFilter" class="col-md-6">
    <div *ngIf="metadata.length == 0 && !loading" style="height:500px;">
      <h5>No Sample Site Results For Current Area.</h5>
    </div>
    <div *ngIf="metadata.length == 0 && loading" style="height:500px;">
      <h5>Loading...</h5>
    </div>
    <div *ngIf="metadata.length > 0" style="height:500px;">
    <h5>Sample Site Results {{filterData.length}}</h5>
    <!-- <input class="form" type="text" (keyup)='tableSearch($event.target.value)' placeholder="Filter Results" id="filterField"> -->
    <div style="overflow: auto; height:468px;" class="table-responsive">
    <table  class="table row-border hover table-striped">
      <tr >
          <th class='header'></th>
          <th class='header'></th>
          <th class='header'>Name</th>
          <th class='header'>Watershed</th>
      </tr>
      <tr *ngFor="let metadatum of filterData">
          <td >
            <button id="linked-{{metadatum.value.microGPS_ID}}" class="btn btn-primary" type="button" (click)="openLinkedPopup(metadatum)">Find</button>
          </td>
          <td >
            <button id="{{metadatum.value.microGPS_ID}}" class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#location-modal" (click)="openModalSite(metadatum)">View</button>
          </td>
          <td width="40%">
            <span #entries>{{metadatum.value.location}}</span>
          </td>
          <td width="40%">
            <span #entries>{{metadatum.value.watershed}}</span>
          </td>
          <td >
            <span *ngIf="metadatum.name == 'Well'">
              {{metadatum.value.yr_drilled}}</span>
              <span *ngIf="metadatum.name == 'Water_Quality_Site'">{{metadatum.value.ProviderName}}</span>
          </td>
          <td width="20%">
              <span *ngIf="metadatum.name == 'Water_Quality_Site' && metadatum.value.resultCount > 0">
                  <a class="btn btn-success" href='https://www.waterqualitydata.us/Result/search?siteid={{metadatum.value.MonitoringLocationIdentifier}}&mimeType=csv&zip=yes&sorted=no' target="_blank" > Download {{metadatum.value.resultCount}} Measurements</a>
              </span>
            <div *ngIf="metadatum.name == 'Well'">
                <span *ngFor="let link of metadatum._links.associationIds ">
                  <a href="#" *ngIf="link.href.indexOf('ikewai-annotated') !== -1" class="btn btn-success btn-sm" (click)="downloadClick(link.href)">Download {{link.href.split('/').slice(-1)[0]}}</a>
                </span>
            </div>
          </td>
        </tr>
      </table>
      </div>
      </div>
    </div>

    <div *ngIf="!isSiteDateGeoFilter" class="col-md-6">
      <div *ngIf="filterData.length == 0" style="height:500px;">
        <h5>No Microbe Results For Current Area.</h5>
      </div>
      <div *ngIf="filterData.length > 0" style="height:500px;">
      <h5>Microbe Results {{microbeMetadata.length}}</h5>
      <div style="overflow: auto; height:468px;" class="table-responsive">
      <table  class="table row-border hover table-striped">
        <tr >
            <th class='header'></th>
            <th class='header'></th>
            <th class='header'>Name</th>
            <th class='header'>Site</th>
        </tr>
        <tr *ngFor="let metadatum of microbeMetadata">
            <td >
              <button id="linked-{{metadatum.value.microGPS_ID}}" class="btn btn-primary" type="button" (click)="openLinkedPopup(metadatum)">Find</button>
            </td>
            <td >
              <button id="{{metadatum.value.microGPS_ID}}" class="btn btn-primary" type="button" data-bs-toggle="modal" data-bs-target="#location-modal" (click)="openModalSite(metadatum)">View</button>
            </td>
            <td width="40%">
              <span #entries>{{metadatum.value.sample_replicate}}</span>
            </td>
            <td width="40%">
              <span #entries>{{metadatum.value.site}}</span>
            </td>
            <td >
              <span *ngIf="metadatum.name == 'Well'">
                {{metadatum.value.yr_drilled}}</span>
                <span *ngIf="metadatum.name == 'Water_Quality_Site'">{{metadatum.value.ProviderName}}</span>
            </td>
            <td width="20%">
                <span *ngIf="metadatum.name == 'Water_Quality_Site' && metadatum.value.resultCount > 0">
                    <a class="btn btn-success" href='https://www.waterqualitydata.us/Result/search?siteid={{metadatum.value.MonitoringLocationIdentifier}}&mimeType=csv&zip=yes&sorted=no' target="_blank" > Download {{metadatum.value.resultCount}} Measurements</a>
                </span>
              <div *ngIf="metadatum.name == 'Well'">
                  <span *ngFor="let link of metadatum._links.associationIds ">
                    <a href="#" *ngIf="link.href.indexOf('ikewai-annotated') !== -1" class="btn btn-success btn-sm" (click)="downloadClick(link.href)">Download {{link.href.split('/').slice(-1)[0]}}</a>
                  </span>
              </div>
            </td>
          </tr>
        </table>
        </div>
        </div>
      </div>

    <div style="padding-top: 10px; padding-bottom: 20px" class="row flex-nowrap" [ngClass]="{'w-100': currentSampleQuery === '', 'w-75': 'currentSampleQuery' !== ''}">
      <div *ngIf="isSiteDateGeoFilter" style="height:500px;">
        <div>
          <button style="margin-bottom: 10px" class="btn btn-primary center" type="button" (click)="toggleMicrobes()">Microbe Filter</button>
          <button style="margin-bottom: 10px; margin-left: 10px" class="btn btn-primary center" type="button">Cultured Bacteria Filter</button>
        </div>
        <h5>Sample Filter</h5>
        <query-builder [(ngModel)]='sampleQuery' [config]='sampleConfig' [formControl]='queryCtrl'>
        </query-builder>
        <div class="container" style="margin-top: 10px">
          <div class="row">
            <div class="col text-center">
              <button class="btn btn-primary center" type="button" (click)="sampleQueryFilter()">Query</button>
              <button style="margin-left: 5px" class="btn btn-primary center" type="button" (click)="resetQuery()">Reset</button>
            </div>
          </div>
        </div>
    </div>
    <div *ngIf="!isSiteDateGeoFilter" style="height:500px;">
      <div>
        <button style="margin-bottom: 10px" class="btn btn-primary center" type="button" (click)="toggleMicrobes()">Sample Filter</button>
        <button style="margin-bottom: 10px; margin-left: 10px" class="btn btn-primary center" type="button">Cultured Bacteria Filter</button>
      </div>
      <h5>Microbes Filter</h5>
      <query-builder [(ngModel)]='microbeQuery' [config]='microbeConfig' [formControl]='queryCtrl'>
      </query-builder>
      <div class="container" style="margin-top: 10px">
        <div class="row">
          <div class="col text-center mx-auto">
            <button class="btn btn-primary center" type="button" (click)="microbeQueryFilter()">Query</button>
            <button style="margin-left: 5px" class="btn btn-primary center" type="button" (click)="resetQuery()">Reset</button>
          </div>
        </div>
      </div>
  </div>
  <div class="p-20 text-wrap w-25 animated fadeInLeft" [ngClass]="{'d-none': currentSampleQuery === '', 'd-block': 'currentSampleQuery' !== ''}" style="padding-top: 47px">
    <h5>Applied Filters</h5>
    <div style="padding-left: 5px; padding-top: 5px">
      <p>{{this.currentReadableQuery}}</p>
      <p *ngIf="currentMicrobeQuery">{{this.currentReadableQuery}}</p>
    </div>
  </div>
</div>


<!-- modal -->
<div id="location-modal" class="modal" tabindex="-1">
  <!-- modal-dialog -->
  <div id="location-dialog" class="modal-dialog modal-xl">
    <!-- modal-content -->
    <div *ngIf="selectedMetadata"  class="modal-content">
      <!-- modal-header -->
      <div class="modal-header">
        <h3>{{selectedMetadata.value.location}}</h3>
         <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        <!-- <h4 class="modal-title">Login</h4> -->
      </div>


      <!-- modal-body -->
      <div class="modal-body">
        <div>
          <div class="container-fluid">
          <div class="row">
            <div class="col-md-6">
              <div leaflet class="mapZoomed pull-left" id="mapZoomedHolder"
                [leafletOptions]="optionsZoomed" 
                (leafletMapReady)="onMapZoomedReady($event)" >
              </div>
              <div *ngFor="let link of selectedMetadata._links.associationIds " style="padding: 5px 0px 5px 0px;" id="dataPreview" >
                <iframe *ngIf="link.href.split('.').pop() === 'pdf'"
                        [src]="this.sanitizeLink('/assets/ViewerJS/#' + link.href.replace('media','download/public'))" width='100%' height='250px' allowfullscreen webkitallowfullscreen></iframe>
                <iframe *ngIf="link.href.split('.').pop() === 'xls' || link.href.split('.').pop() === 'xlsx'"
                        [src]="this.sanitizeLink('https://view.officeapps.live.com/op/embed.aspx?src=' + link.href)" width="100%" height="250px" frameborder="1" allowfullscreen webkitallowfullscreen></iframe>
                <h6 *ngIf="link.href.split('.').pop() === 'jpg' || link.href.split('.').pop() === 'png'">{{link.href.split('/').pop()}}</h6>
                <img *ngIf="link.href.split('.').pop() === 'jpg' || link.href.split('.').pop() === 'png'"
                     [src]="this.sanitizeLink(link.href.replace('https://ikeauth.its.hawaii.edu', ''))" style="max-width: 100%;">
                <div id="tempDiv" style="visibility: hidden;"></div>
              </div>
            </div>
            <div *ngIf="selectedMetadata.name === 'TEST_Site_Date_Geochem'" class="col-md-4 overflow-auto" style="height: 250px; width: 50%">
              <b>Location:</b>&nbsp;{{selectedMetadata.value.location}}<br/>
              <b>Watershed :</b>&nbsp;{{selectedMetadata.value.watershed}}<br/>
              <span *ngIf="selectedMetadata.value.time"><b>Time :</b>&nbsp;{{selectedMetadata.value.time}}<br/></span>
              <span *ngIf="selectedMetadata.value.date"><b>Date :</b>&nbsp;{{selectedMetadata.value.date}}<br/></span>
              <span *ngIf="selectedMetadata.value.season"><b>Season :</b>&nbsp;{{selectedMetadata.value.season}}<br/></span>
              <span *ngIf="selectedMetadata.value.year"><b>Year :</b>&nbsp;{{selectedMetadata.value.year}}<br/></span>
              <span *ngIf="selectedMetadata.value.temp_c"><b>Temperature :</b>&nbsp;{{selectedMetadata.value.temp_c}} °C<br/></span>
              <span *ngIf="selectedMetadata.value.ph"><b>pH :</b>&nbsp;{{selectedMetadata.value.ph}}<br/></span>
              <span *ngIf="selectedMetadata.value.water_level_cm"><b>Water Level :</b>&nbsp;{{selectedMetadata.value.water_level_cm}} cm<br/></span>
              <span *ngIf="selectedMetadata.value.do_percent"><b>DO_Percent :</b>&nbsp;{{selectedMetadata.value.do_percent}} %<br/></span>
              <span *ngIf="selectedMetadata.value.do_mg_l"><b>DO_mg.L :</b>&nbsp;{{selectedMetadata.value.do_mg_l}}<br/></span>
              <span *ngIf="selectedMetadata.value.spc_us"><b>SPC_US :</b>&nbsp;{{selectedMetadata.value.spc_us}}<br/></span>
              <span *ngIf="selectedMetadata.value.sal_ppt"><b>Sal_ppt :</b>&nbsp;{{selectedMetadata.value.sal_ppt}}<br/></span>
              <span *ngIf="selectedMetadata.value.turbidity"><b>Turbidity :</b>&nbsp;{{selectedMetadata.value.turbidity}}<br/></span>
              <span *ngIf="selectedMetadata.value.tdn_umol_l"><b>TDN.umol.L :</b>&nbsp;{{selectedMetadata.value.tdn_umol_l}}<br/></span>
              <span *ngIf="selectedMetadata.value.tdp_umol_l"><b>TDP.umol.L :</b>&nbsp;{{selectedMetadata.value.tdp_umol_l}}<br/></span>
              <span *ngIf="selectedMetadata.value.PO4_umol_l"><b>PO4.umol.L :</b>&nbsp;{{selectedMetadata.value.PO4_umol_l}}<br/></span>
              <span *ngIf="selectedMetadata.value.si_umol_l"><b>SI.umol.L :</b>&nbsp;{{selectedMetadata.value.si_umol_l}}<br/></span>
              <span *ngIf="selectedMetadata.value.nox_umol_l"><b>NOX.umol.L :</b>&nbsp;{{selectedMetadata.value.nox_umol_l}}<br/></span>
              <span *ngIf="selectedMetadata.value.nh4_umol_l"><b>NH4.umol.L :</b>&nbsp;{{selectedMetadata.value.nh4_umol_l}}<br/></span>
              <span *ngIf="selectedMetadata.value.toc_umol_l"><b>TOC.umol.L :</b>&nbsp;{{selectedMetadata.value.toc_umol_l}}<br/></span>
              <span *ngIf="selectedMetadata.value.cor_tdn_umol_l"><b>COR TDN.umol.L :</b>&nbsp;{{selectedMetadata.value.cor_tdn_umol_l}}<br/></span>
              <span *ngIf="selectedMetadata.value.cor_tdp_umol_l"><b>COR TDP.umol.L :</b>&nbsp;{{selectedMetadata.value.cor_tdp_umol_l}}<br/></span>
              <span *ngIf="selectedMetadata.value.cor_PO4_umol_l"><b>COR PO4.umol.L :</b>&nbsp;{{selectedMetadata.value.cor_PO4_umol_l}}<br/></span>
              <span *ngIf="selectedMetadata.value.cor_nox_umol_l"><b>COR NOX.umol.L :</b>&nbsp;{{selectedMetadata.value.cor_nox_umol_l}}<br/></span>
              <span *ngIf="selectedMetadata.value.cor_nh4_umol_l"><b>COR NH4.umol.L :</b>&nbsp;{{selectedMetadata.value.cor_nh4_umol_l}}<br/></span>

              <div *ngFor="let link of selectedMetadata._links.associationIds " style="padding: 5px 0px 5px 0px;">
                <a href="#" *ngIf="link.href.indexOf('ikewai-annotated') !== -1" class="btn btn-success btn-sm" 
                   (click)="downloadClick(link.href)">
                    <img class="images" src="assets/fileicons/{{link.href.split('.').pop()}}.png" height="40px"/>
                    Download {{link.href.split('/').slice(-1)[0]}}</a>
              </div>
              </div>
              <div *ngIf="selectedMetadata.name === 'TEST_Microbes'" class="col-md-4">
                <b>ID:</b>&nbsp;{{selectedMetadata.value.id}}<br/>
                <b>Date:</b>&nbsp;{{selectedMetadata.value.date}}<br/>
                <b>Site:</b>&nbsp;{{selectedMetadata.value.site}}<br/>
                <span *ngIf="selectedMetadata.value.filter_size_um"><b>Filter Size UM:</b>&nbsp;{{selectedMetadata.value.filter_size_um}} °C<br/></span>
                <span *ngIf="selectedMetadata.value.volume_l"><b>Volume L:</b>&nbsp;{{selectedMetadata.value.volume_l}}<br/></span>
                <span *ngIf="selectedMetadata.value.lifestyle"><b>Lifestyle:</b>&nbsp;{{selectedMetadata.value.lifestyle}} cm<br/></span>
            
                <div *ngFor="let link of selectedMetadata._links.associationIds " style="padding: 5px 0px 5px 0px;">
                  <a href="#" *ngIf="link.href.indexOf('ikewai-annotated') !== -1" class="btn btn-success btn-sm" 
                     (click)="downloadClick(link.href)">
                      <img class="images" src="assets/fileicons/{{link.href.split('.').pop()}}.png" height="40px"/>
                      Download {{link.href.split('/').slice(-1)[0]}}</a>
                </div>
                </div>
            </div>
          </div>
<!--
draft_mgd: null
draft_mgy: null
draft_yr: null
driller: null
gps: false
head_feet: null
init_cl: null
init_head: null
init_head2: null
init_head3: null
land_owner: null
lat83dd: 21.70361111
latest_hd: null
latitude: 21.70361111
loc: {type: "Point", coordinates: Array(2)}
long83dd: -157.9647222
longitude: -157.9647222
max_chlor: null
min_chlor: null
old_name: null
old_number: null
perf_case: 108
pir: null
published: "True"
pump_depth: null
pump_elev: null
pump_gpm: 150
pump_installer: null
pump_mgd: 0.216
pump_yr: null
quad_map: 7
salinity: null
spec_capac: null
surveyor: null
t: null
temp_c: null
temp_f: null
test_chlor: null
test_date: null
test_ddown: null
test_gpm: null
test_temp: null
test_unit: null
tmk: "(1) 5-6-002:009"
use_year: null
utm: true
wcr: "1980-01-01T00:00:00" -->

        </div>
      </div>

      <!-- modal-footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-bs-dismiss="modal" (click)="hideModal()" >Close</button>
      </div>
    </div>
  </div>
</div>

